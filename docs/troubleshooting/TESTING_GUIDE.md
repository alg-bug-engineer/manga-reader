# ğŸ§ª Gemini API æµ‹è¯•æŒ‡å—

æœ¬æŒ‡å—æä¾›äº†å¤šç§æ–¹å¼æµ‹è¯• Gemini API è¿æ¥ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½å’Œè§£å†³é—®é¢˜ã€‚

## ğŸ“‹ æµ‹è¯•æ–¹å¼æ¦‚è§ˆ

| æµ‹è¯•æ–¹å¼ | éš¾åº¦ | è¯¦ç»†åº¦ | æ¨èåº¦ |
|---------|------|--------|--------|
| **æ–¹å¼ 1: curl å‘½ä»¤** | â­ | â­â­ | â­â­â­ |
| **æ–¹å¼ 2: Bash è„šæœ¬** | â­â­ | â­â­â­ | â­â­â­â­ |
| **æ–¹å¼ 3: Node.js è„šæœ¬** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |

---

## æ–¹å¼ 1: ä½¿ç”¨ curl å‘½ä»¤ï¼ˆæœ€å¿«ï¼‰

### æµ‹è¯• 1.1: åŸºæœ¬è¿æ¥æµ‹è¯•

```bash
# æµ‹è¯•æ˜¯å¦èƒ½è®¿é—® Gemini API
curl -I "https://generativelanguage.googleapis.com"
```

**é¢„æœŸç»“æœï¼š**
```
HTTP/2 200
content-type: application/json; charset=UTF-8
...
```

**å¦‚æœå¤±è´¥ï¼š**
- é…ç½®ä»£ç†ï¼š`export HTTPS_PROXY=http://127.0.0.1:7890`
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ä½¿ç”¨ VPN

---

### æµ‹è¯• 1.2: ç®€å• API è¯·æ±‚

```bash
# è®¾ç½®ä½ çš„ API Key
export GEMINI_API_KEY="your_actual_api_key_here"

# å‘é€ç®€å•è¯·æ±‚
curl "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=$GEMINI_API_KEY" \
  -H "Content-Type: application/json" \
  -H "x-goog-api-key: $GEMINI_API_KEY" \
  -X POST \
  -d '{
    "contents": [{
      "parts": [{"text": "Hello, Gemini!"}]
    }]
  }'
```

**é¢„æœŸç»“æœï¼š**
```json
{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "Hello! ..."
          }
        ]
      },
      "finishReason": "STOP",
      "index": 0
    }
  ]
}
```

**å¸¸è§é”™è¯¯ï¼š**
- `401`: API Key æ— æ•ˆ
- `403`: API Key æ²¡æœ‰æƒé™
- `Connection timeout`: ç½‘ç»œé—®é¢˜ï¼Œé…ç½®ä»£ç†

---

## æ–¹å¼ 2: ä½¿ç”¨ Bash è„šæœ¬ï¼ˆæ¨èï¼‰

### è¿è¡Œæµ‹è¯•è„šæœ¬

```bash
# ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡è¿è¡Œï¼‰
chmod +x test-gemini-api.sh

# è¿è¡Œæµ‹è¯•
./test-gemini-api.sh
```

### è„šæœ¬åŠŸèƒ½

è„šæœ¬ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æµ‹è¯•ï¼š

1. âœ… åŠ è½½ç¯å¢ƒå˜é‡
2. âœ… éªŒè¯ API Key
3. âœ… æµ‹è¯•ç½‘ç»œè¿æ¥
4. âœ… æµ‹è¯•ç®€å• API è¯·æ±‚
5. âœ… æµ‹è¯•è„šæœ¬ç”ŸæˆåŠŸèƒ½

### è¾“å‡ºç¤ºä¾‹

```
ğŸ§ª Gemini API è¿æ¥æµ‹è¯•
======================

âœ… å·²åŠ è½½ .env.local
âœ… API Key å·²é…ç½® (é•¿åº¦: 39)

é…ç½®ä¿¡æ¯:
  - æ¨¡å‹: gemini-2.0-flash-exp
  - è¶…æ—¶: 120ç§’

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 1: åŸºæœ¬ç½‘ç»œè¿æ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… å¯ä»¥è¿æ¥åˆ° generativelanguage.googleapis.com

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 2: ç®€å• API è¯·æ±‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¯·æ±‚: https://generativelanguage.googleapis.com/...

å‘é€è¯·æ±‚...
HTTP çŠ¶æ€ç : 200
âœ… API è¯·æ±‚æˆåŠŸ!

å“åº”å†…å®¹:
{
  "candidates": [...]
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 3: è„šæœ¬ç”Ÿæˆï¼ˆç®€åŒ–ç‰ˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æµ‹è¯•æ¦‚å¿µ: Token
ç”Ÿæˆç®€çŸ­çš„ 3 æ ¼è„šæœ¬...

HTTP çŠ¶æ€ç : 200
âœ… è„šæœ¬ç”ŸæˆæˆåŠŸ!

ç”Ÿæˆçš„è„šæœ¬:
[
  {
    "panelNumber": 1,
    "sceneDescription": "çŒ«æŒ‡ç€æœºå™¨äºº...",
    "dialogue": "çŒ«ï¼šä»€ä¹ˆæ˜¯ Tokenï¼Ÿ"
  },
  ...
]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä½ çš„ Gemini API é…ç½®æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼
```

---

## æ–¹å¼ 3: ä½¿ç”¨ Node.js è„šæœ¬ï¼ˆæœ€è¯¦ç»†ï¼‰

### è¿è¡Œæµ‹è¯•

```bash
# ç¡®ä¿å·²å®‰è£… Node.js
node --version  # åº”è¯¥æ˜¾ç¤º v18 æˆ–æ›´é«˜

# è¿è¡Œæµ‹è¯•è„šæœ¬
node test-gemini-api.js
```

### æµ‹è¯•åŠŸèƒ½

Node.js è„šæœ¬æä¾›æœ€è¯¦ç»†çš„æµ‹è¯•å’Œè¯Šæ–­ï¼š

1. ğŸ¨ **å½©è‰²è¾“å‡º** - æ¸…æ™°çš„æˆåŠŸ/å¤±è´¥æ ‡è¯†
2. ğŸ“Š **è¯¦ç»†æ—¥å¿—** - å®Œæ•´çš„è¯·æ±‚å’Œå“åº”æ•°æ®
3. â±ï¸ **æ€§èƒ½è®¡æ—¶** - æ˜¾ç¤ºæ¯ä¸ªè¯·æ±‚çš„è€—æ—¶
4. ğŸ” **é”™è¯¯åˆ†æ** - è‡ªåŠ¨åˆ†æé”™è¯¯åŸå› å¹¶ç»™å‡ºè§£å†³æ–¹æ¡ˆ
5. ğŸ“ **è„šæœ¬è§£æ** - éªŒè¯ç”Ÿæˆçš„è„šæœ¬æ ¼å¼

### è¾“å‡ºç¤ºä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸ§ª Gemini API åŠŸèƒ½æµ‹è¯•å·¥å…·      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… ç¯å¢ƒå˜é‡å·²åŠ è½½
API Key: AIzaSyD_0i...5LUN4
æ¨¡å‹: gemini-2.0-flash-exp
è¶…æ—¶: 60 ç§’

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 1: åŸºæœ¬ç½‘ç»œè¿æ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å¯ä»¥è¿æ¥åˆ° Gemini API æœåŠ¡å™¨
çŠ¶æ€ç : 200

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 2: ç®€å• API è¯·æ±‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

API æ¨¡å‹: gemini-2.0-flash-exp
è¯·æ±‚ URL: https://generativelanguage.googleapis.com/...

å‘é€è¯·æ±‚...
âœ… API è¯·æ±‚æˆåŠŸ!

å“åº”æ•°æ®:
{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "Hello! I'm Gemini, how can I help you today?"
          }
        ]
      },
      "finishReason": "STOP"
    }
  ]
}

ç”Ÿæˆçš„æ–‡æœ¬: Hello! I'm Gemini, how can I help you today?

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¡ æµ‹è¯• 3: è„šæœ¬ç”Ÿæˆï¼ˆç®€åŒ–ç‰ˆï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

æ¦‚å¿µ: Token
ç”Ÿæˆæ ¼æ•°: 3

å‘é€è¯·æ±‚...
âœ… è„šæœ¬ç”ŸæˆæˆåŠŸ!
è€—æ—¶: 5234ms

ç”Ÿæˆçš„è„šæœ¬æ–‡æœ¬:
[
  {
    "panelNumber": 1,
    "sceneDescription": "çŒ«æŒ‡ç€æœºå™¨äººï¼Œä¸€è„¸å¥½å¥‡",
    "dialogue": "çŒ«ï¼šå•¥æ˜¯ Tokenï¼Ÿå¬èµ·æ¥åƒæŸç§ä»£å¸ï¼Ÿ"
  },
  {
    "panelNumber": 2,
    "sceneDescription": "æœºå™¨äººæ‹¿å‡ºä¸€å—ç§¯æœ¨ï¼ŒæŠŠå®ƒåˆ‡æˆå°å—",
    "dialogue": "æœºå™¨äººï¼šä¸ä¸ä¸ï¼Token å°±åƒç§¯æœ¨ï¼Œä¸ºäº†å¥½æ‹¼è£…ï¼Œå¾—å…ˆåˆ‡æˆå°å—ï¼"
  },
  {
    "panelNumber": 3,
    "sceneDescription": "çŒ«æç„¶å¤§æ‚Ÿï¼Œæœºå™¨äººå¾—æ„åœ°å‰è…°",
    "dialogue": "çŒ«ï¼šå“¦ï¼åŸæ¥å°±æ˜¯æŠŠæ–‡å­—åˆ‡ç¢äº†ï¼\næœºå™¨äººï¼šæ­£è§£ï¼è¿™æ ·æ‰èƒ½è®© AI æ¶ˆåŒ–å˜›ï¼"
  }
]

è§£æåçš„è„šæœ¬:

ç¬¬ 1 æ ¼:
  ç”»é¢: çŒ«æŒ‡ç€æœºå™¨äººï¼Œä¸€è„¸å¥½å¥‡
  å°è¯: çŒ«ï¼šå•¥æ˜¯ Tokenï¼Ÿå¬èµ·æ¥åƒæŸç§ä»£å¸ï¼Ÿ

ç¬¬ 2 æ ¼:
  ç”»é¢: æœºå™¨äººæ‹¿å‡ºä¸€å—ç§¯æœ¨ï¼ŒæŠŠå®ƒåˆ‡æˆå°å—
  å°è¯: æœºå™¨äººï¼šä¸ä¸ä¸ï¼Token å°±åƒç§¯æœ¨ï¼Œä¸ºäº†å¥½æ‹¼è£…ï¼Œå¾—å…ˆåˆ‡æˆå°å—ï¼

ç¬¬ 3 æ ¼:
  ç”»é¢: çŒ«æç„¶å¤§æ‚Ÿï¼Œæœºå™¨äººå¾—æ„åœ°å‰è…°
  å°è¯: çŒ«ï¼šå“¦ï¼åŸæ¥å°±æ˜¯æŠŠæ–‡å­—åˆ‡ç¢äº†ï¼\næœºå™¨äººï¼šæ­£è§£ï¼è¿™æ ·æ‰èƒ½è®© AI æ¶ˆåŒ–å˜›ï¼

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æµ‹è¯•ç»“æœæ€»ç»“
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç½‘ç»œè¿æ¥: âœ… é€šè¿‡
ç®€å•è¯·æ±‚: âœ… é€šè¿‡
è„šæœ¬ç”Ÿæˆ: âœ… é€šè¿‡

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘      âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä½ çš„ Gemini API é…ç½®æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨äº†ï¼

ä¸‹ä¸€æ­¥:
  1. è¿è¡Œå¼€å‘æœåŠ¡å™¨:
     npm run dev
  2. è®¿é—®ç”Ÿæˆå™¨:
     http://localhost:3000/generate-comic
  3. è¾“å…¥ AI æ¦‚å¿µå¼€å§‹åˆ›ä½œï¼
```

---

## ğŸ”§ é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: è¿æ¥è¶…æ—¶

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: Connect Timeout Error
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **é…ç½®ä»£ç†ï¼ˆæ¨èï¼‰**
```bash
# è®¾ç½®ä»£ç†
export HTTP_PROXY=http://127.0.0.1:7890
export HTTPS_PROXY=http://127.0.0.1:7890

# é‡æ–°è¿è¡Œæµ‹è¯•
./test-gemini-api.sh
```

2. **ä½¿ç”¨ VPN**
- è¿æ¥åˆ°å¯ä»¥è®¿é—® Google çš„ VPN
- é‡æ–°è¿è¡Œæµ‹è¯•

3. **æµ‹è¯•ç½‘ç»œè¿æ¥**
```bash
curl -I "https://www.google.com"
```

---

### é—®é¢˜ 2: API Key æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯ï¼š**
```json
{
  "error": {
    "code": 401,
    "message": "API key invalid"
  }
}
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **éªŒè¯ API Key**
```bash
# æŸ¥çœ‹ API Key
cat .env.local | grep GEMINI_API_KEY
```

2. **é‡æ–°ç”Ÿæˆ API Key**
   - è®¿é—®ï¼šhttps://makersuite.google.com/app/apikey
   - åˆ é™¤æ—§çš„ Key
   - åˆ›å»ºæ–°çš„ Key
   - æ›´æ–° `.env.local` æ–‡ä»¶

3. **æ£€æŸ¥ API Key æƒé™**
   - ç¡®ä¿å¯ç”¨äº† Generative Language API
   - æ£€æŸ¥é…é¢æ˜¯å¦ç”¨å®Œ

---

### é—®é¢˜ 3: æ¨¡å‹ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```json
{
  "error": {
    "code": 404,
    "message": "Model not found"
  }
}
```

**è§£å†³æ–¹æ¡ˆï¼š**

1. **æ£€æŸ¥æ¨¡å‹åç§°**
```bash
# æŸ¥çœ‹å½“å‰é…ç½®
cat .env.local | grep GEMINI_SCRIPT_MODEL
```

2. **ä½¿ç”¨æ­£ç¡®çš„æ¨¡å‹**
```
gemini-2.0-flash-exp    âœ… æ¨è
gemini-1.5-pro          âœ… å¯ç”¨
gemini-1.5-flash        âœ… å¯ç”¨
gemini-3-pro-preview    âš ï¸  é¢„è§ˆç‰ˆ
```

3. **æ›´æ–°ç¯å¢ƒå˜é‡**
```bash
# ç¼–è¾‘ .env.local
GEMINI_SCRIPT_MODEL=gemini-2.0-flash-exp
GEMINI_IMAGE_MODEL=gemini-2.0-flash-exp
```

---

## ğŸ“Š æµ‹è¯•æ£€æŸ¥æ¸…å•

è¿è¡Œæµ‹è¯•å‰ï¼Œç¡®ä¿ï¼š

- [ ] å·²åˆ›å»º `.env.local` æ–‡ä»¶
- [ ] API Key å·²æ­£ç¡®é…ç½®
- [ ] ç½‘ç»œå¯ä»¥è®¿é—® Google æœåŠ¡
- [ ] Node.js ç‰ˆæœ¬ >= 18
- [ ] å·²å®‰è£…é¡¹ç›®ä¾èµ– (`npm install`)

---

## ğŸ¯ æ¨èæµ‹è¯•æµç¨‹

### ç¬¬ä¸€æ¬¡ä½¿ç”¨

1. **å¿«é€Ÿæµ‹è¯•**ï¼ˆ1åˆ†é’Ÿï¼‰
   ```bash
   curl -I "https://generativelanguage.googleapis.com"
   ```

2. **å®Œæ•´æµ‹è¯•**ï¼ˆ2åˆ†é’Ÿï¼‰
   ```bash
   ./test-gemini-api.sh
   ```

3. **è¯¦ç»†æµ‹è¯•**ï¼ˆ3åˆ†é’Ÿï¼‰
   ```bash
   node test-gemini-api.js
   ```

### æ¯æ¬¡ä¿®æ”¹é…ç½®å

1. éªŒè¯é…ç½®æ–‡ä»¶
   ```bash
   cat .env.local
   ```

2. è¿è¡Œå¿«é€Ÿæµ‹è¯•
   ```bash
   node test-gemini-api.js
   ```

3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   ```bash
   npm run dev
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

1. **[GEMINI_API_DEBUG.md](./GEMINI_API_DEBUG.md)** - å®Œæ•´çš„è°ƒè¯•æŒ‡å—
2. **[LOGGING_GUIDE.md](./LOGGING_GUIDE.md)** - æ—¥å¿—ç³»ç»Ÿä½¿ç”¨æŒ‡å—
3. **[setup-gemini.sh](./setup-gemini.sh)** - API Key é…ç½®è„šæœ¬

---

## âœ… æ€»ç»“

æ¨èä½¿ç”¨ **Node.js è„šæœ¬**è¿›è¡Œæµ‹è¯•ï¼Œå› ä¸ºå®ƒæä¾›ï¼š

- âœ… æœ€è¯¦ç»†çš„æµ‹è¯•è¦†ç›–
- âœ… å½©è‰²è¾“å‡ºï¼Œæ˜“äºé˜…è¯»
- âœ… è‡ªåŠ¨é”™è¯¯åˆ†æ
- âœ… æ€§èƒ½æ•°æ®ç»Ÿè®¡
- âœ… è„šæœ¬æ ¼å¼éªŒè¯

**å¿«é€Ÿå‘½ä»¤ï¼š**
```bash
# å®Œæ•´æµ‹è¯•
node test-gemini-api.js

# å¯åŠ¨é¡¹ç›®
npm run dev
```

---

*æ›´æ–°æ—¶é—´ï¼š2025-12-31*
*ç‰ˆæœ¬ï¼šv1.0.0*
